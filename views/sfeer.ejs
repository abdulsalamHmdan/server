<!doctype html>
<html lang="ar" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    <%=name%> - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
  </title>
  <style>
    * {
      box-sizing: border-box;
      /* direction: ltr !important; */
    }

    :root {
      --bg-color: #f4f5f7;
      --card-bg: #ffffff;
      --primary-btn: #5c524d;
      --loading: #5c524d;
      --secondary-btn: #ffffff;
      --text-main: #2d3436;
      --text-muted: #636e72;
      --border-color: #edf2f7;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      /* font-family: "IBM Plex Sans Arabic", system-ui, -apple-system, "SF Pro Display", "SF Pro Text", Arial, sans-serif; */
      /* background-color: var(--bg-color); */
      background:
        radial-gradient(900px 600px at 10% 0%,
          rgba(155, 217, 228, 0.35),
          transparent 60%),
        radial-gradient(900px 700px at 95% 15%,
          rgba(68, 49, 41, 0.14),
          transparent 55%),
        radial-gradient(1100px 700px at 50% 120%,
          rgba(0, 0, 0, 0.04),
          transparent 60%),
        var(--bg-color);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-main);
    }

    .container {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Header Area */
    .header {
      text-align: center;
      margin-bottom: 10px;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
    }

    .header h1 {
      font-size: 1.2rem;
      margin: 0;
    }

    .code-badge {
      background: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    /* Card Style */
    .card {
      background: var(--card-bg);
      border-radius: 25px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      position: relative;
    }

    .card-number {
      /* position: absolute; */
      top: 20px;
      right: 20px;
      background: #f8f9fa;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 0.7rem;
      color: #999;
      border: 1px solid #eee;
    }

    .card-title {
      direction: ltr;
      text-align: center;
      /* margin-top: 10px; */
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
    }

    .card-title h2 {
      font-size: 1.1rem;
      margin: 0;
      text-align: right;
    }

    .card-title p {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 5px 0 15px 0;
    }

    /* Image Placeholder */
    .image-box {
      max-width: 440px;
      height: 250px;
      background: #e2e8f0;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Input & Link Styles */
    .link-section {
      background: #fdfdfd;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .link-text {
      font-size: 0.8rem;
      color: #3182ce;
      word-break: break-all;
      margin-left: 10px;
    }

    .message-preview {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 15px;
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text-muted);
      margin-bottom: 15px;
      text-align: justify;
    }

    /* Target Grid */
    .target-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }


    .target-item {
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: 15px;
      padding: 15px;
      text-align: right;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      direction: rtl;
    }

    .target-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: block;
    }

    .target-value {
      font-size: 1.2rem;
      font-weight: bold;
      margin-top: 5px;
      display: block;
    }

    .order-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .order-item {
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
    }

    .order-label {
      font-size: 1.5rem;
      color: var(--text-muted);
      display: block;
    }

    .order-value {
      font-size: 1.2rem;
      font-weight: bold;
      margin-top: 5px;
      display: block;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      margin-bottom: 10px;
      box-sizing: border-box;
      background: #fcfcfc;
      text-align: center;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-size: 0.95rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 10px;
      transition: opacity 0.2s;
    }

    .btn-primary {
      background-color: var(--primary-btn);
      color: white;
    }

    .btn-outline {
      background-color: var(--secondary-btn);
      color: var(--text-main);
      border: 1px solid var(--border-color);
    }

    .btn-logout {
      background-color: white;
      color: #2d3436;
      margin-top: 10px;
    }

    .footer-note {
      font-size: 0.7rem;
      color: #a0aec0;
      text-align: center;
      margin-top: 5px;
    }

    .empty-state {
      padding: 30px;
      text-align: center;
      border: 1px dashed #cbd5e0;
      border-radius: 15px;
      margin-bottom: 15px;

    }

    .cell {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 0;
      border-bottom: 1px solid #000;

    }

    #tasksList {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .loader {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: block;
      margin: 15px auto;
      position: relative;
      background: #FFF;
      box-shadow: -24px 0 #FFF, 24px 0 #FFF;
      box-sizing: border-box;
      animation: shadowPulse 2s linear infinite;
    }

    @keyframes shadowPulse {
      33% {
        background: #FFF;
        box-shadow: -24px 0 var(--loading), 24px 0 #FFF;
      }

      66% {
        background: var(--loading);
        box-shadow: -24px 0 #FFF, 24px 0 #FFF;
      }

      100% {
        background: #FFF;
        box-shadow: -24px 0 #FFF, 24px 0 var(--loading);
      }
    }

    /* Coupon Card Enhanced Styles */
    .coupon-card {
      background: linear-gradient(135deg, #ffffff 0%, #fdfbf9 100%);
      border: 2px solid #f1ede9;
      overflow: hidden;
    }

    .thanks-header {
      text-align: center;
      padding: 10px 0;
      border-bottom: 1px dashed #d1c4b9;
      margin-bottom: 15px;
    }

    .thanks-title {
      color: #8b6b4d;
      font-weight: bold;
      font-size: 1.1rem;
      margin: 5px 0;
    }

    .discount-badge {
      background: #5c524d;
      color: #fff;
      display: inline-block;
      padding: 8px 20px;
      border-radius: 0 0 15px 15px;
      font-size: 0.9rem;
      margin-top: -20px;
      box-shadow: 0 4px 10px rgba(92, 82, 77, 0.2);
    }

    .qr-wrapper {
      background: #fff;
      padding: 10px;
      border-radius: 12px;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.02);
      display: inline-block;
      border: 1px solid #eee;
    }

    .value-tag {
      font-size: 1.8rem;
      font-weight: 900;
      color: #5c524d;
      margin: 10px 0;
      display: block;
    }

    .value-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="code-badge">
        83923 <span style="opacity: 0.7; font-size: 12px">CODE</span>
      </div>
      <div class="cont">
        <p style="font-size: 0.8rem; color: #718096; margin-bottom: 5px">
          Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø±
        </p>
        <h1>
          <%=name%>
        </h1>
      </div>
    </div>

    <div class="card">
      <div class="card-title">
        <div class="card-number">001</div>
        <div class="cont">
          <h2>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø±</h2>
          <p>Ø§Ù†Ø³Ø®/Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø©</p>
        </div>
      </div>
      <div class="image-box">
        <img src="/img/<%= img%>" alt="Library" />
      </div>
      <div class="link-section">
        <div class="link-text">
          <%=url%>
        </div>
        <button id="urlSave" class="btn-outline" style="
              width: auto;
              padding: 5px 15px;
              margin: 0;
              font-size: 0.75rem;
            ">
          Ù†Ø³Ø®
        </button>
      </div>
      <div class="message-preview">
        <%=text%>
      </div>
      <button id="share-btn" class="btn btn-primary">Ù…Ø´Ø§Ø±ÙƒØ©</button>
      <button id="copy-btn" class="btn btn-outline">Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
    </div>
    <div class="card">
      <div class="card-title">
        <div class="card-number">002</div>
        <div class="cont">
          <h2>Ø§Ù„Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
          <p>Ù…Ø®Ø·Ø· Ø§Ù„Ø§Ø¹Ù…Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
        </div>
      </div>
      <ul class="list" id="tasksList" style="margin-top: 8px" dir="rtl">
        <% goals.forEach(x=>{ %>
          <li class="cell" style="cursor: pointer">
            <div>
              <div class="value">
                <%=x.goal%>
              </div>
              <div class="label">
                <%=x.label%>
              </div>
            </div>
            <div style="text-align: left">
              <div class="check">â¬œï¸</div>
            </div>
          </li>
          <%})%>
      </ul>
    </div>

    <div class="card">
      <div class="card-title">
        <div class="card-number">003</div>
        <div class="cont">
          <h2>Ù…Ø³ØªÙ‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ø³Ø±Ø¹Ø©</p>
        </div>
      </div>
      <div class="target-grid">
        <div class="target-item">
          <div class="cont">
            <span class="target-label">Ù‡Ø¯Ù Ø§Ù„Ù…Ø¨Ù„Øº</span>
            <span class="target-value" dir="rtl">
              <%= payGoal%> Ø±.Ø³.
            </span>
          </div>
          <span class="target-label">/ ÙŠÙˆÙ…</span>
        </div>
        <div class="target-item">
          <div class="cont">
            <span class="target-label">Ù‡Ø¯Ù Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</span>
            <span class="target-value">
              <%= boxGoal%>
            </span>

          </div>
          <span class="target-label">/ ÙŠÙˆÙ…</span>
        </div>

        <div class="target-item">
          <span class="loader"></span>
        </div>

        <div class="target-item">
          <span class="loader"></span>
        </div>
      </div>
      <button id="refreshG" class="btn btn-primary">ØªØ­Ø¯ÙŠØ« Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</button>
      <button id="coupon" class="btn btn-outline">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</button>
      <p class="footer-note">
      </p>
    </div>
    <% if (true) { %>
          <div class="card coupon" dir="rtl">
    <div style="text-align: center;">
        <div class="discount-badge">Ø®ØµÙ… Ø®Ø§Øµ Ù„Ùƒ</div>
    </div>

    <div class="thanks-header">
        <h2 class="thanks-title">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙˆÙ†Ùƒ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø£Ø«Ø±Ù†Ø§! ğŸŒŸ</h2>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin: 0;">ØªÙ‚Ø¯ÙŠØ±Ø§Ù‹ Ù„Ø¬Ù‡ÙˆØ¯Ùƒ Ø§Ù„Ù…Ø¨Ø°ÙˆÙ„Ø©ØŒ Ø¥Ù„ÙŠÙƒ Ù‡Ø¯ÙŠØ© Ø¨Ø³ÙŠØ·Ø©</p>
    </div>
    <div style="text-align: center; margin-bottom: 15px;">
        <span class="value-label">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</span>
        <span class="value-tag"><%= couponValue %> Ø±.Ø³</span>
        
        <div class="qr-wrapper">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=<%= couponCode %>" alt="QR Code" style="display: block;" />
        </div>
        
        <div class="entity-name" style="margin-top: 10px; color: #5c524d;"><%= entityName %></div>
    </div>
    <div class="copy-box" style="border: 1.5px solid #d1c4b9; background: #fff;">
        <div class="code-value" id="couponText" style="color: #5c524d; letter-spacing: 3px;"><%= couponCode %></div>
        <button class="copy-icon-btn" onclick="copyCoupon()" id="copyBtn">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#8b6b4d" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        </button>
    </div>
    <p class="footer-note" style="margin-top: 12px;">ÙŠÙ†ØªÙ‡ÙŠ ØªØ§Ø±ÙŠØ® ØµÙ„Ø§Ø­ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ù‚Ø±ÙŠØ¨Ø§Ù‹ØŒ Ø¨Ø§Ø¯Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡!</p>


  </div>
      <%}%>


    <div class="card ranking">
      <div class="card-title">
        <div class="card-number">004</div>
        <div class="cont">
          <h2>ØªØ±ØªÙŠØ¨Ùƒ Ø¨ÙŠÙ† Ø§Ù„Ø³ÙØ±Ø§Ø¡</h2>
          <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« : <span id="refreshTime" style="color: #3182ce;">Ø§Ù„Ø§Ù†</span></p>
        </div>
      </div>
      <div class="order-grid">

        <div class="order-item">
          <span class="order-label">ØªØ±ØªÙŠØ¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙØ±Ø§Ø¡</span>
          <span class="order-value" dir="rtl">
            <span class="loader"></span>
          </span>
        </div>

        <div class="order-item">
          <span class="order-label">ØªØ±ØªÙŠØ¨Ùƒ Ø¹Ù„Ù‰ Ø³ÙØ±Ø§Ø¡ ÙØ±Ø¹Ùƒ</span>
          <span class="order-value" dir="rtl">
            <span class="loader"></span>
          </span>
        </div>

        <div class="order-item">
          <span class="order-label">ØªØ±ØªÙŠØ¨ ÙØ±Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±ÙˆØ¹</span>
          <span class="order-value" dir="rtl">
            <span class="loader"></span>
          </span>
        </div>

      </div>
      <button class="btn btn-primary" id="refreshR">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨</button>
      <p class="footer-note">
        <!-- Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„ØªØªØ¨Ø¹ Ù…Ø­Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±). Ù„Ùˆ ØªØ¨ÙŠ Ø§Ù„ØªØªØ¨Ø¹ Ù…Ø±ÙƒØ²ÙŠ
        Ù„ÙƒÙ„ Ø§Ù„Ø³ÙØ±Ø§Ø¡ Ù†Ø±Ø¨Ø·Ù‡ Ø¨Ù…Ù„Ù CSV/Google Sheet/Netlify Function. -->
      </p>
    </div>


    <div class="card boxes">

      <div class="card-title">
        <div class="card-number">005</div>

        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>

      <div class="empty-state">
        <p style="color: #000000; font-size: 1.5rem">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</p>
      </div>
      <button class="btn btn-primary" onclick="boxesAll()">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</button>
      <button class="btn btn-outline" onclick="boxesToday()">Ø¹Ø±Ø¶ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„ÙŠÙˆÙ…</button>
    </div>



    <button class="btn btn-outline btn-logout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>
</body>

<!-- <script src="js/main2.js"></script> -->

<script defer>
  // vars
  const shareBtn = document.querySelector("#share-btn");
  const copyBtn = document.querySelector("#copy-btn");
  const urlSave = document.querySelector("#urlSave");
  const btnLogout = document.querySelector(".btn-logout");
  const refreshG = document.querySelector("#refreshG");
  const refreshR = document.querySelector("#refreshR");
  const couponBtn = document.querySelector("#coupon");

  //buttons

  shareBtn.addEventListener("click", async () => {
    const imageUrl = "/img/<%= img%>";
    const shareText = `<%=text%>`;
    // Ø§Ù„ØªØ£ÙƒØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø£Ø³Ø§Ø³Ø§Ù‹ Ø®Ø§ØµÙŠØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    if (!navigator.share) {
      alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ.");
      return;
    }

    try {
      const response = await fetch(imageUrl);
      const blob = await response.blob();
      const file = new File([blob], "share_image.png", { type: "image/png" });

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù…Ø´Ø§Ø±ÙƒØ© "Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯"
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          files: [file],
          text: shareText,
          title: "Ø±Ø³Ø§Ù„Ø© Ù†Ø´Ø±", // Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªØ·Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        });
      } else {
        // Ø¥Ø°Ø§ ÙØ´Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„ÙØŒ Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„Ù†Øµ (Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
        await navigator.share({
          text: shareText,
        });
      }
    } catch (error) {
      console.error("ÙØ´Ù„Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:", error);
      // ÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ Fetch (CORS Ù…Ø«Ù„Ø§Ù‹)ØŒ Ø´Ø§Ø±Ùƒ Ø§Ù„Ù†Øµ ÙÙ‚Ø·
      navigator.share({ text: shareText }).catch(() => { });
    }
  });
  document.querySelectorAll(".cell").forEach(x => {
    x.addEventListener('click', () => {
      if (x.querySelector(".check").innerHTML == "âœ…") {
        x.querySelector(".check").innerHTML = "â¬œï¸"

      } else {
        x.querySelector(".check").innerHTML = "âœ…"

      }
    })
  })
  copyBtn.addEventListener("click", () => {
    const message = `<%=text%>`
    navigator.clipboard
      .writeText(message)
      .then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!"))
      .catch((error) => alert("ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©: " + error));
  });
  urlSave.addEventListener("click", () => {
    const message = `<%=url%>`
    navigator.clipboard
      .writeText(message)
      .then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!"))
      .catch((error) => alert("ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©: " + error));
  });
  btnLogout.addEventListener("click", () => {
    location.href = "/<%=id%>"
  });
  refreshG.addEventListener('click', () => {
    const els = document.querySelectorAll(".target-item");
    els[2].innerHTML = `<span class="loader"></span>`;
    els[3].innerHTML = `<span class="loader"></span>`;
    goals()
  })

  refreshR.addEventListener('click', () => {
    const els = document.querySelectorAll(".order-value");
    els.forEach(x => x.innerHTML = `<span class="loader"></span>`);
    rank()
  })


  // boxPart

  function boxesForm() {
    document.querySelector(".boxes").innerHTML = `
  <div class="card-title">
        <div class="card-number">004</div>
        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>

      <div class="empty-state">
        <p style="color: #000000; font-size: 1.5rem">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</p>
      </div>
      <button class="btn btn-primary" onclick="boxesAll()">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</button>
      <button class="btn btn-outline" onclick="boxesToday()">Ø¹Ø±Ø¶ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„ÙŠÙˆÙ…</button>
  `;
  }
  async function boxesAll() {
    document.querySelector(".empty-state p").innerHTML = `<span class="loader"></span>`
    const req = await fetch("boxes?all=yes", {
      method: 'GET',
      headers: {
        'Content-Type': "application/json"
      }
    })
    const boxes = await req.json();
    console.log(boxes)
    if (boxes.length == 0) {
      document.querySelector(".boxes").innerHTML = `<div class="card-title">
        <div class="card-number">004</div>
        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>
      <div class="empty-state">
        <p style="color: #a0aec0; font-size: 0.9rem">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</p>
        <p style="font-weight: bold">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙ†Ø§Ø¯ÙŠÙ‚</p>
      </div>
      <button class="btn btn-outline" onclick="boxesForm()">Ø¹ÙˆØ¯Ø©</button>`;
    }
    else {
      document.querySelector(".boxes").innerHTML = `<div class="card-title">
        <div class="card-number">005</div>
        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>
      <button class="btn btn-outline" onclick="boxesForm()">Ø¹ÙˆØ¯Ø©</button>

      <div class="boxes-container" style="margin-top: 20px;">

      </div>`;

      boxes.forEach(boxData => {

        document.querySelector(".boxes-container").innerHTML += `<div class="fund-box" style="border: 1px solid #e0e0e0; border-radius: 15px; overflow: hidden; margin-bottom: 20px; background-color: #ffffff; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
      <div class="fund-category" style="background-color: #f1ede9; padding: 8px; text-align: center; border-bottom: 1px dashed #d1c4b9;">
        <span style="color: #5d4037; font-weight: bold; font-size: 0.95rem; letter-spacing: 0.5px;">
          ${boxData["name"]}
        </span>
      </div>
      <div class="fund-body" style="padding: 20px;">
        <div class="fund-header" style="text-align: center; margin-bottom: 15px;">
          <img width="80%" src="https://donate.utq.org.sa/media/prods/1/17697347830.webp">
        </div>
        <div class="progress-container" style="margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; color: #8b6b4d;">
            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
            <span>${boxData["sum"] / boxData["goal"] * 100}%</span>
          </div>
          <div class="progress-bar-container" style="background: #eee; direction: rtl; height: 12px; border-radius: 10px; overflow: hidden;">
            <div class="progress-fill" style="background: linear-gradient(90deg, #8b6b4d, #bcaaa4); width: ${boxData["sum"] / boxData["goal"] * 100}%; height: 100%;"></div>
          </div>
        </div>
        <div class="fund-stats" style="display: flex;direction: rtl; justify-content: space-around; background: #fafafa; padding: 10px; border-radius: 10px;">
          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">${boxData["goal"]} <small style="font-size: 0.7rem;">Ø±ÙŠØ§Ù„</small></strong>
          </div>
                    <div style="width: 1px; background: #eee;"></div>

          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">${boxData["sum"]} <small style="font-size: 0.7rem;">Ø±ÙŠØ§Ù„</small></strong>
          </div>
          <div style="width: 1px; background: #eee;"></div>
          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">993</strong>
          </div>
        </div>
      </div>
    </div>`;
      })

    }
  }
  async function boxesToday() {
    document.querySelector(".empty-state p").innerHTML = `<span class="loader"></span>`
    const req = await fetch("boxes?all=no", {
      method: 'GET',
      headers: {
        'Content-Type': "application/json"
      }
    })
    const boxes = await req.json();
    console.log(boxes)
    if (boxes.length == 0) {
      document.querySelector(".boxes").innerHTML = `<div class="card-title">
        <div class="card-number">004</div>
        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>
      <div class="empty-state">
        <p style="color: #a0aec0; font-size: 0.9rem">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</p>
        <p style="font-weight: bold">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙ†Ø§Ø¯ÙŠÙ‚</p>
      </div>
      <button class="btn btn-outline" onclick="boxesForm()">Ø¹ÙˆØ¯Ø©</button>`;
    }
    else {
      document.querySelector(".boxes").innerHTML = `<div class="card-title">
        <div class="card-number">005</div>
        <div class="cont">
          <h2>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø³Ù‡Ù…ÙŠØ©</h2>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø² ØµÙ†Ø§Ø¯ÙŠÙ‚Ùƒ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· donate.utq.org.sa</p>
        </div>
      </div>
      <button class="btn btn-outline" onclick="boxesForm()">Ø¹ÙˆØ¯Ø©</button>

      <div class="boxes-container" style="margin-top: 20px;">

      </div>`;

      boxes.forEach(boxData => {

        document.querySelector(".boxes-container").innerHTML += `<div class="fund-box" style="border: 1px solid #e0e0e0; border-radius: 15px; overflow: hidden; margin-bottom: 20px; background-color: #ffffff; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
      <div class="fund-category" style="background-color: #f1ede9; padding: 8px; text-align: center; border-bottom: 1px dashed #d1c4b9;">
        <span style="color: #5d4037; font-weight: bold; font-size: 0.95rem; letter-spacing: 0.5px;">
          ${boxData["name"]}
        </span>
      </div>
      <div class="fund-body" style="padding: 20px;">
        <div class="fund-header" style="text-align: center; margin-bottom: 15px;">
          <img width="80%" src="https://donate.utq.org.sa/media/prods/1/17697347830.webp">
        </div>
        <div class="progress-container" style="margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; color: #8b6b4d;">
            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
            <span>${boxData["sum"] / boxData["goal"] * 100}%</span>
          </div>
          <div class="progress-bar-container" style="background: #eee; direction: rtl; height: 12px; border-radius: 10px; overflow: hidden;">
            <div class="progress-fill" style="background: linear-gradient(90deg, #8b6b4d, #bcaaa4); width: ${boxData["sum"] / boxData["goal"] * 100}%; height: 100%;"></div>
          </div>
        </div>
        <div class="fund-stats" style="display: flex;direction: rtl; justify-content: space-around; background: #fafafa; padding: 10px; border-radius: 10px;">
          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">${boxData["goal"]} <small style="font-size: 0.7rem;">Ø±ÙŠØ§Ù„</small></strong>
          </div>
                    <div style="width: 1px; background: #eee;"></div>

          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">${boxData["sum"]} <small style="font-size: 0.7rem;">Ø±ÙŠØ§Ù„</small></strong>
          </div>
          <div style="width: 1px; background: #eee;"></div>
          <div style="text-align: center;">
            <span style="display: block; font-size: 0.75rem; color: #999; margin-bottom: 3px;">Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†</span>
            <strong style="color: #8b6b4d; font-size: 1.1rem;">993</strong>
          </div>
        </div>
      </div>
    </div>`;
      })

    }
  }



  // fetching

  function rank() {
    fetch("rank", {
      method: "GET",
      headers: {
        'Content-Type': "application/json"
      }
    }).then(x => x.json()).then(x => {
      const els = document.querySelectorAll(".order-value");
      els[0].innerHTML = x.a;
      els[1].innerHTML = x.b;
      els[2].innerHTML = x.c;
    })

  }
  rank();

  function goals() {
    fetch("goals", {
      method: "GET",
      headers: {
        'Content-Type': "application/json"
      }
    }).then(x => x.json()).then(x => {
      const els = document.querySelectorAll(".target-item");
      els[2].innerHTML = `
      <div class="cont">
        <span class="target-label">Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„ÙŠÙˆÙ…</span>
        <span class="target-value">${x.payment}</span>
      </div>
      <span class="target-label">Ø±ÙŠØ§Ù„</span>`;
      els[3].innerHTML = `<div class="cont">
            <span class="target-label">Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„ÙŠÙˆÙ…</span>
            <span class="target-value">${x.boxes}</span>
          </div>
          <span class="target-label">ØµÙ†Ø¯ÙˆÙ‚</span>`;

    })

  }
  goals();

  couponBtn.addEventListener("click", addCoupon);

  function addCoupon() {
    if (document.querySelector("#couponText")) {
      document.querySelector(".card.coupon").scrollIntoView({ behavior: "smooth" });
      return;
    }else{
      const newCard = document.createElement("div");
      newCard.innerHTML = `
    <div style="text-align: center;">
        <div class="discount-badge">Ø®ØµÙ… Ø®Ø§Øµ Ù„Ùƒ</div>
    </div>

    <div class="thanks-header">
        <h2 class="thanks-title">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙˆÙ†Ùƒ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø£Ø«Ø±Ù†Ø§! ğŸŒŸ</h2>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin: 0;">ØªÙ‚Ø¯ÙŠØ±Ø§Ù‹ Ù„Ø¬Ù‡ÙˆØ¯Ùƒ Ø§Ù„Ù…Ø¨Ø°ÙˆÙ„Ø©ØŒ Ø¥Ù„ÙŠÙƒ Ù‡Ø¯ÙŠØ© Ø¨Ø³ÙŠØ·Ø©</p>
    </div>
    <div style="text-align: center; margin-bottom: 15px;">
        <span class="value-label">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</span>
        <span class="value-tag"><%= couponValue %> Ø±.Ø³</span>
        
        <div class="qr-wrapper">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=<%= couponCode %>" alt="QR Code" style="display: block;" />
        </div>
        
        <div class="entity-name" style="margin-top: 10px; color: #5c524d;"><%= entityName %></div>
    </div>
    <div class="copy-box" style="border: 1.5px solid #d1c4b9; background: #fff;">
        <div class="code-value" id="couponText" style="color: #5c524d; letter-spacing: 3px;"><%= couponCode %></div>
        <button class="copy-icon-btn" onclick="copyCoupon()" id="copyBtn">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#8b6b4d" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        </button>
    </div>
    <p class="footer-note" style="margin-top: 12px;">ÙŠÙ†ØªÙ‡ÙŠ ØªØ§Ø±ÙŠØ® ØµÙ„Ø§Ø­ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ù‚Ø±ÙŠØ¨Ø§Ù‹ØŒ Ø¨Ø§Ø¯Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡!</p>      
      `;
      newCard.className = "card coupon";
      newCard.dir="rtl";
      document.querySelector(".container").insertBefore(newCard, document.querySelector(".card.ranking"));
    }
    
  }

</script>

</html>